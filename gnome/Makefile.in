topsrc = @top_srcdir@

tooldir = $(topsrc)/tools
docdir = $(topsrc)/doc

INSTALL = @INSTALL@
prefix = @prefix@
gnome_prefix = @gnome_prefix@
have_gnome = @have_gnome@

ifeq ($(gnome_prefix),NA)
  gnome_prefix = $(prefix)
endif

GCONFTOOL = @GCONFTOOL@
GCONF_SCHEMA_CONFIG_SOURCE = @GCONF_SCHEMA_CONFIG_SOURCE@
GCONF_SCHEMA_FILE_DIR = @GCONF_SCHEMA_FILE_DIR@

ifeq ($(INSTALL_DATA),)
  INSTALL_DATA = $(INSTALL) -m 644
endif

ifeq ($(have_gnome),2.0)
  omfdir = ../gui2/omf-install
  install_schemas = install-gconf-keys install-gconf-schema-file
  schemadir = $(GCONF_SCHEMA_FILE_DIR)
endif

desktopdir = $(gnome_prefix)/share/applications
mimedir = $(gnome_prefix)/share/mime-info
gpixmaps = $(gnome_prefix)/share/pixmaps
schemadir = $(gnome_prefix)/etc/gconf/schemas

install: install-images install-misc $(install_schemas)

install-images:
	$(tooldir)/mkinstalldirs $(gpixmaps)
	$(INSTALL_DATA) $(topsrc)/pixmaps/gretl.xpm $(gpixmaps)
	$(INSTALL_DATA) $(topsrc)/pixmaps/gretl-logo.xpm $(gpixmaps)
	$(INSTALL_DATA) $(topsrc)/gnome/gnome-*.png $(gpixmaps)

install-misc:
	$(tooldir)/mkinstalldirs $(desktopdir)
	$(INSTALL_DATA) $(topsrc)/gnome/gretl.desktop $(desktopdir)
	$(tooldir)/mkinstalldirs $(mimedir)
	$(INSTALL_DATA) $(topsrc)/gnome/gretl.mime $(mimedir)
	$(INSTALL_DATA) gretl.keys $(mimedir)

install-gconf-keys:
	GCONF_CONFIG_SOURCE=$(GCONF_SCHEMA_CONFIG_SOURCE) \
	$(GCONFTOOL) --makefile-install-rule $(topsrc)/gnome/gretl.schemas

install-gconf-schema-file: $(topsrc)/gnome/gretl.schemas	
	$(tooldir)/mkinstalldirs $(schemadir)
	$(INSTALL_DATA) $(topsrc)/gnome/gretl.schemas $(schemadir)


